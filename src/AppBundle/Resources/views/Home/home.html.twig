{# EXTENDEMOS LA PLANTILLA 'AppBundle:Layouts:layout.html.twig'...................... #}
  {% extends "AppBundle:Layouts:layout.html.twig"%}
{# ......................EXTENDEMOS LA PLANTILLA 'AppBundle:Layouts:layout.html.twig' #}
{% block content %}
		{# CARGO LAS VARIABLES DE LA URL DE ENTRADA ................................................................................................ #}
			{% set documentsList = clinic.documentsList %}
		{# ................................................................................................ CARGO LAS VARIABLES DE LA URL DE ENTRADA #}
		<!-- page content -->
			<div class="right_col" role="main">
				<!-- top tiles -->
					<div class="row tile_count">
						<div class="col-md-2 col-sm-4 col-xs-6 tile_stats_count">
							<span class="count_top"><i class="fa fa-user"></i> Total Users</span>
							<div class="count">2500</div>
							<span class="count_bottom"><i class="green">4% </i> From last Week</span>
						</div>
						<div class="col-md-2 col-sm-4 col-xs-6 tile_stats_count">
							<span class="count_top"><i class="fa fa-clock-o"></i> Average Time</span>
							<div class="count">123.50</div>
							<span class="count_bottom"><i class="green"><i class="fa fa-sort-asc"></i>3% </i> From last Week</span>
						</div>
						<div class="col-md-2 col-sm-4 col-xs-6 tile_stats_count">
							<span class="count_top"><i class="fa fa-user"></i> Total Males</span>
							<div class="count green">2,500</div>
							<span class="count_bottom"><i class="green"><i class="fa fa-sort-asc"></i>34% </i> From last Week</span>
						</div>
						<div class="col-md-2 col-sm-4 col-xs-6 tile_stats_count">
							<span class="count_top"><i class="fa fa-user"></i> Total Females</span>
							<div class="count">4,567</div>
							<span class="count_bottom"><i class="red"><i class="fa fa-sort-desc"></i>12% </i> From last Week</span>
						</div>
						<div class="col-md-2 col-sm-4 col-xs-6 tile_stats_count">
							<span class="count_top"><i class="fa fa-user"></i> Total Collections</span>
							<div class="count">2,315</div>
							<span class="count_bottom"><i class="green"><i class="fa fa-sort-asc"></i>34% </i> From last Week</span>
						</div>
						<div class="col-md-2 col-sm-4 col-xs-6 tile_stats_count">
							<span class="count_top"><i class="fa fa-user"></i> Total Connections</span>
							<div class="count">7,325</div>
							<span class="count_bottom"><i class="green"><i class="fa fa-sort-asc"></i>34% </i> From last Week</span>
						</div>
					</div>
				<!-- /top tiles -->
            <div class="">
              <div class="clearfix"></div>
              <div class="row">
                <div class="col-lg-4 col-md-6 col-sm-6 col-xs-12">
                  <div class="x_panel" >
                    <div class="x_title">
                      <h3 style="display:inline;">Datos de Clínica</h3>
                      <ul class="nav navbar-right panel_toolbox">
                        <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                        </li>
                        <li class="dropdown">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                          <ul class="dropdown-menu" role="menu">
                            <li><a href="#">Settings 1</a>
                            </li>
                            <li><a href="#">Settings 2</a>
                            </li>
                          </ul>
                        </li>
                        <li><a class="close-link"><i class="fa fa-close"></i></a>
                        </li>
                      </ul>									
                      <div class="clearfix"></div>
                    </div>
                    <div class="x_content">
                      <div class="col-lg-12 col-md-6 col-sm-12 col-xs-6 profile_left">
                        <div class="profile_img">
                          <div id="crop-avatar">
                            {# IMAGEN DE CLINICA SI EXISTIESE O NO UN REGISTRO......................................................... #}
                              {% if clinic.image == null %}
                                <img class="img-responsive avatar-view" src="{{ asset ('assets/images/default_clinic.png') }}" alt="Avatar" title="Change the avatar" style ="max-width:170px;width:100%;">
                              {% else %}
                                <img lass="img-responsive avatar-view" src="{{ asset ('uploads/clinics/'~clinic.nameUrl~'/'~clinic.image) }}" alt="Avatar" title="Change the avatar" style ="max-width:170px;width:100%;"/>
                              {% endif %}
                            {# ..........................................................IMAGEN DE CLINICA SI EXISTIESE O NO UN REGISTRO #}
                          </div>
                        </div>
                      </div>
                      <div class="col-lg-12 col-md-6 col-sm-12 col-xs-6 profile_left">
                        {% if clinic.name != NULL %}
                          <h3>{{clinic.name | upper}}</h3>
                        {% endif %}
                        <ul class="list-unstyled user_data">
                          {% if clinic.phone != NULL %}
                            <li>
                              <i class="fa fa-phone user-profile-icon"></i>
                              {{clinic.phone}}
                            </li>
                          {% endif %}
                          {% if clinic.address != NULL %}
                            <li>
                              <i class="fa fa-map-marker user-profile-icon"></i>
                              {{clinic.address | title}}, <br/>
                              {% if clinic.city != NULL %}
                                {{clinic.city | title}}
                                <br/>
                              {% endif %}
                            </li>
                          {% endif %}
                          {% if clinic.registrationDate != NULL %}
                            <li>
                              <i class="fa fa-calendar-o user-profile-icon"></i>
                              {{clinic.registrationDate | date("d/m/Y")}}<br/>
                            </li>
                          {% endif %}
                        </ul>
                      </div>{#}
                      <a class="btn btn-success pull-right"
                        
                        href="{{ path("clinic_create", {clinicNameUrl:ClinicsUser.nameUrl}) }}"
                        >
                        <i class="fa fa-edit m-right-xs"></i>
                        Editar
                      </a>#}
                    </div>
                  </div>
                  <br />
                </div>
                <!-- Users Clinic -->
                  <div class="col-lg-4 col-md-6 col-sm-6 col-xs-12">
                    <div class="x_panel">
                      <div class="x_title">
                        <h3 style="display:inline;">Usuarios</h3>
                        <ul class="nav navbar-right panel_toolbox">
                          <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                          </li>
                          <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                            <ul class="dropdown-menu" role="menu">
                              <li><a href="#">Settings 1</a>
                              </li>
                              <li><a href="#">Settings 2</a>
                              </li>
                            </ul>
                          </li>
                          <li><a class="close-link"><i class="fa fa-close"></i></a>
                          </li>
                        </ul>
                        <div class="clearfix"></div>
                      </div>
                      <div class="x_content">
                        <table class="table table-striped">
                          <thead>
                            <tr>
                              <th>Nick</th>
                              <th>Nombre</th>
                              <th>Apellidos</th>
                            </tr>
                          </thead>
                          <tbody>
                            {% for user in clinicUser %}
                              {% set user = user.user %}
                              <tr>
                                <td><a href="{{ path ("clinic_view", {clinicNameUrl:clinic.nameUrl})}}">{{user.userName}}</a></td>
                                <td>{{user.name}}</td>
                                <td>{{user.surnames}}</td>
                              </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                <!-- /Users Clinic -->
                <!-- Medical Histories -->
                  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="x_panel">
                      <div class="x_title">
                        <h3 style="display:inline;">Estadísticas Historias Médicas</h3>
                        <ul class="nav navbar-right panel_toolbox">
                          <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                          </li>
                          <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                            <ul class="dropdown-menu" role="menu">
                              <li><a href="#">Settings 1</a>
                              </li>
                              <li><a href="#">Settings 2</a>
                              </li>
                            </ul>
                          </li>
                          <li><a class="close-link"><i class="fa fa-close"></i></a>
                          </li>
                        </ul>
                        <div class="clearfix"></div>
                      </div>
                      <div class="x_content">
                        <!-- nuevos pacientes por mes -->
                          <h4 style="display:inline;">Nuevos Pacientes por Mes</h4>
                          <div class="clearfix"></div>
                          <div class="divider-dashed"></div>
                          <div class="col-lg-9 col-md-9 col-sm-12 col-xs-12">
                            <div id="chart_plot_newUsersPerMonth" class="demo-placeholder"></div>
                          </div>
                        <!-- /nuevos pacientes por mes -->
                        <div class="clearfix"></div>
                        <div class="divider-dashed"></div>				
                        <!-- ratio sexo pacientes -->
                          <h4 style="display:inline;">Proporciones por Género</h4>
                          <div class="clearfix"></div>
                          <div class="divider-dashed"></div>
                          <div style="display: flex;">
                            <div class="col-lg-3 col-md-4 col-sm-3 col-xs-6" style="padding:0;">
                              <iframe class="chartjs-hidden-iframe" style="width: 90%; display: block; border: 0px; height: 0px; margin: 0px; position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px;"></iframe>
                              <canvas id="doughnutChart" height="150" width="150" style=" width: 140px; height: 140px;"></canvas>
                            </div>
                            <div class="col-lg-9 col-md-8 col-sm-9 col-xs-12" style="display: flex;justify-content: center;flex-direction: column;">
                              <table class="table table-striped">
                                <thead>
                                  {% set totalMedicalHistories = medicalHistoryRatioSex[0].number + medicalHistoryRatioSex[1].number + medicalHistoryRatioSex[2].number %}
                                  <tr>
                                    <th style="width:95px;">TOTAL</td>
                                    <th style="width:95px;" class="text-right">{{totalMedicalHistories}}</td>
                                    <th style="width:95px;" class="text-right">100,00 %</td>
                                  </tr>
                                </thead>
                                <tbody>
                                  {% for key, sex in medicalHistoryRatioSex %}
                                    {% if key == 0 %}
                                      {% set color = "#E5E5E5" %}
                                    {% elseif key == 1 %}
                                      {% set color = "#455C73" %}
                                    {% elseif key == 2 %}
                                      {% set color = "#26B99A" %}
                                    {% endif %}
                                    <tr>
                                      <td class="text-left"><i class="fa fa-square" style="color:{{color}}"></i>{% if sex.gender == null %} Sin definir{% else %} {{sex.gender}}{% endif %}</td>
                                      <td class="text-right">{{sex.number}}</td>
                                      <td class="text-right">{{sex.percent|number_format(2, ',', '.')}}%</td>
                                    </tr>
                                  {% endfor %}										
                                </tbody>
                              </table>
                            </div>
                          </div>
                        <!-- ratio sexo pacientes -->
                      </div>
                    </div>
                  </div>
                <!-- /medical Histories -->
                <!-- Documents -->
                  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="x_panel">
                      <div class="x_title">
                        <h3 style="display:inline;">Documentos</h3>
                        <ul class="nav navbar-right panel_toolbox">
                          <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                          </li>
                          <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                            <ul class="dropdown-menu" role="menu">
                              <li><a href="#">Settings 1</a>
                              </li>
                              <li><a href="#">Settings 2</a>
                              </li>
                            </ul>
                          </li>
                          <li><a class="close-link"><i class="fa fa-close"></i></a>
                          </li>
                        </ul>
                        <div class="clearfix"></div>
                      </div>
                      <div class="x_content">
                        <table class="table table-striped">
                          <thead>
                            <tr>
                              <th>Nick</th>
                              <th>Nombre</th>
                              <th>Apellidos</th>
                            </tr>
                          </thead>
                          <tbody>
                            {% for documents in documentsList %}
                              {% set type = documents.typeContentDoc.type %}
                              {% if documents.typeContentDoc.type == 'clinic' %}
                                <tr>
                                  <td>{{documents.description}}</a></td>
                                  <td>{% if type == 'pdf' %}<i class="fa fa-file-pdf-o">{% endif %}</td>
                                  <td>{{documents.registrationDate | date('d/m/Y')}}</td>
                                </tr>
                              {% endif %}
                            {% endfor %}
                          </tbody>
                        </table>
                        <a href="{{ path ("clinic_doc_list", {clinicNameUrl:clinic.nameUrl})}}">Listado completo</a>
                      </div>
                    </div>
                  </div>
                <!-- /Documents -->
                <!-- Servicios -->
                  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="x_panel">
                      <div class="x_title">
                        <h3 style="display:inline;">Servicios</h3>
                        <ul class="nav navbar-right panel_toolbox">
                          <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                          </li>
                          <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                            <ul class="dropdown-menu" role="menu">
                              <li><a href="#">Settings 1</a>
                              </li>
                              <li><a href="#">Settings 2</a>
                              </li>
                            </ul>
                          </li>
                          <li><a class="close-link"><i class="fa fa-close"></i></a>
                          </li>
                        </ul>
                        <div class="clearfix"></div>
                      </div>
                      <div class="x_content">
                        <table id="datatable-buttons-services" class="table table-striped table-bordered bulk_action" style="width:100%;">
                          <thead>
                            <tr>
                              <th>Nº</th>
                              <th>Servicio</th>
                              <th> €</th>
                              <th>Precio Máximo</th>
                              <th>Peso</th>
                              <th>Estado</th>
                            </tr>
                          </thead>
                          <tbody>
                            {% set orderParent = 0 %}
                            {% for service in servicesList %}
                              {% if service.typeService == false and service.parent == null %}
                                {% set orderParent = orderParent + 1 %}
                                {% set parentId = service.id %}
                                <tr>
                                  <td>{{orderParent}}</td>
                                  <td>{{service.name}}</td>
                                  <td class="text-right">{{service.minimalPrice}} €</td>
                                  <td class="text-right">{{service.maximumPrice}} €</td>
                                  <td class="text-center">{{service.weight}}</td>
                                  <td  class="text-center">
                                    {% if service.state == true %}
                                      <i class="fa fa-toggle-on m-right-xs"></i>
                                    {% else %}
                                      <i class="fa fa-toggle-off m-right-xs"></i>
                                    {% endif %}</td>
                                <tr>
                                {% set orderChild = 0 %}
                                {% for serviceChild in service.childrenList %}
                                  {% if serviceChild.updatedService == null %}
                                    {% set orderChild = orderChild + 1 %}
                                    <tr>
                                      <td>{{orderParent}}.{{orderChild}}</td>
                                      <td>
                                        {{serviceChild.name}}
                                        {% if serviceChild.updatedList != null %}
                                          {% for updatedService in serviceChild.updatedList %}
                                            <br>{{serviceChild.updatedList[0].name}}
                                          {% endfor %}
                                        {% endif %}
                                      </td>
                                      <td class="text-right">
                                        {{serviceChild.minimalPrice}} €{% if serviceChild.updatedList != null %}{% for updatedService in serviceChild.updatedList %}<br>{{serviceChild.updatedList[0].minimalPrice}} €{% endfor %}{% endif %}																		
                                      </td>
                                      <td class="text-right">{{serviceChild.maximumPrice}} €</td>
                                      <td  class="text-center">{{serviceChild.weight}}</td>
                                      <td class="text-center">
                                        {% if serviceChild.state == true %}
                                          <i class="fa fa-toggle-on m-right-xs"></i>
                                        {% else %}
                                          <i class="fa fa-toggle-off m-right-xs"></i>
                                        {% endif %}
                                      </td>
                                    <tr>
                                  {% endif %}
                                {% endfor %}
                              {% endif %}
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                <!-- /Servicios -->						
              </div>
            </div>
        <!-- /page content -->
{% endblock %}
{% block javascriptsFinal %}
	{{ parent() }}
	<!-- Chart.js -->
	<script src="{{ asset ('assets/vendors/Chart.js/dist/Chart.min.js') }}"></script>
	<!-- Custom.js -->
	<script>
		//doughnut{}
		var ctxD = document.getElementById("doughnutChart").getContext('2d');
		var myLineChart = new Chart(ctxD, {
			type: 'doughnut',
			data: {
				labels: ["{{medicalHistoryRatioSex[1].gender}}","{{medicalHistoryRatioSex[2].gender}}"],
				datasets: [
					{
						data: [{{medicalHistoryRatioSex[1].number}}, {{medicalHistoryRatioSex[2].number}}, {{medicalHistoryRatioSex[0].number}}],
						backgroundColor: ["#455C73", "#26B99A"],
						hoverBackgroundColor: ["#FF5A5E", "#5AD3D1"]
					}
				]
			},
			options: {
				responsive: true
			}
		});
	</script>
	<script>
		function init_flot_chart(){
			if( typeof ($.plot) === 'undefined'){ return; }
			console.log('init_flot_chart_plot_newUsersPerMonth');
			{% set years = newUsersPerMonth|length %}
			{% if years > 3 %}
				{% set fristYear = newUsersPerMonth|length - 3  %}
			{% else %}
				{% set fristYear = 0  %}
			{% endif %}
			{% set start = 0 %}
			{% for year, dataYear in newUsersPerMonth %}
				{% set start = start + 1 %}
				{% if start > fristYear%}
				var arr_data_{{year}} = [
					{% for month, dataMonth in dataYear %}
						[gd(2000, {{month}}, 15 ), {{dataMonth}}],
					{% endfor %}
				];
				{% endif %}
			{% endfor %}
			var chart_plot_newUsersPerMonth_settings = {
				series: {
					lines: {
						show: false,
						fill: true
					},
					splines: {
						show: true,
						tension: 0.4,
						lineWidth: 1,
						fill: 0.4
					},
					points: {
						radius: 0,
						show: true
					},
					shadowSize: 2
				},
				grid: {
					verticalLines: true,
					hoverable: true,
					clickable: true,
					tickColor: "#d5d5d5",
					borderWidth: 1,
					color: '#fff'
				},
				colors: [
					{% set r = 3 %}
					{% set g = 88 %}
					{% set b = 106 %}
					{% if years > 3 %}
						{% set fristYear = newUsersPerMonth|length - 3  %}
					{% else %}
						{% set fristYear = 0  %}
					{% endif %}
					{% set start = 0 %}
					{% for year, dataYear in newUsersPerMonth %}
						{% set start = start + 1 %}
						{% if start > fristYear %}
							"rgba({{r}}, {{g}}, {{b}}, 0.05)",
							{% if start == fristYear + 1 %}
								{% set r = r + 35 %}{% set g = g + 97 %}{% set b = b + 48 %}
							{% else %}
								{% set r = r - 18 %}{% set g = g - 30 %}{% set b = b - 28 %}
							{% endif %}
						{% endif %}
					{% endfor %}
					//"rgba(3, 88, 106, 0.38)", "rgba(38, 185, 154, 0.38)", "rgba(rgba(20, 155, 126, 0.38)"
					],
				xaxis: {
					tickColor: "rgba(51, 51, 51, 0.06)",
					mode: "time",
					tickSize: [1, "month"],
					//tickLength: 10,
					axisLabel: "Date",
					axisLabelUseCanvas: true,
					axisLabelFontSizePixels: 12,
					axisLabelFontFamily: 'Verdana, Arial',
					axisLabelPadding: 10
				},
				yaxis: {
					ticks: 8,
					tickColor: "rgba(51, 51, 51, 0.06)",
				},
				tooltip: false
			}	
			if ($("#chart_plot_newUsersPerMonth").length){
				console.log('Plot1');
				$.plot( $("#chart_plot_newUsersPerMonth"), 
				[ 
					{% if years > 3 %}
						{% set fristYear = newUsersPerMonth|length - 3  %}
					{% else %}
						{% set fristYear = 0  %}
					{% endif %}
					{% set start = 0 %}
					{% for year, dataYear in newUsersPerMonth %}
						{% set start = start + 1 %}
						{% if start > fristYear %}
							arr_data_{{year}}, 
						{% endif %}
					{% endfor %} 
				],  
				chart_plot_newUsersPerMonth_settings );
			}
		}																									
	</script>	
{% endblock %}
